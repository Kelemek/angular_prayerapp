<div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border border-gray-200 dark:border-gray-700">
  <div class="flex items-center gap-2 mb-4">
    <svg class="text-red-600 dark:text-red-400" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="11" cy="11" r="8"></circle>
      <path d="m21 21-4.35-4.35"></path>
    </svg>
    <h3 class="text-lg font-medium text-gray-800 dark:text-gray-100">
      Prayer Editor
    </h3>
  </div>

  <p class="text-sm text-gray-600 dark:text-gray-300 mb-4">
    Search and filter prayers by title, requester, email, description, or denial reasons. Use dropdown filters to automatically load results. Delete individually or in bulk.
  </p>

  <!-- Search Input -->
  <div class="flex gap-2 mb-4">
    <div class="flex-1 relative">
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (keypress)="onKeyPress($event)"
        placeholder="Search by title, requester, email, description, or denial reasons..."
        class="w-full px-4 py-2 pr-10 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-red-500"
      />
      <button
        *ngIf="searchTerm"
        (click)="clearSearch()"
        class="absolute right-2 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"
      >
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <button
      (click)="handleSearch()"
      [disabled]="searching"
      class="flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-red-400 disabled:cursor-not-allowed transition-colors"
    >
      <div *ngIf="searching" class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
      <svg *ngIf="!searching" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
      {{ searching ? 'Searching...' : 'Search' }}
    </button>
  </div>

  <!-- Filter Dropdowns -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
    <!-- Prayer Status Filter -->
    <div>
      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
        Prayer Status
      </label>
      <div class="relative">
        <select
          [(ngModel)]="statusFilter"
          (change)="onStatusFilterChange()"
          class="w-full appearance-none px-3 py-2 text-sm border border-blue-300 dark:border-blue-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 pr-10 cursor-pointer"
        >
          <option value="">Select status...</option>
          <option value="all">All Statuses</option>
          <option value="current">Current</option>
          <option value="answered">Answered</option>
          <option value="archived">Archived</option>
        </select>
        <svg class="pointer-events-none absolute right-3 top-1/2 transform -translate-y-1/2 text-blue-600 dark:text-blue-400" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
      </div>
    </div>

    <!-- Approval Status Filter -->
    <div>
      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
        Approval Status
      </label>
      <div class="relative">
        <select
          [(ngModel)]="approvalFilter"
          (change)="onApprovalFilterChange()"
          class="w-full appearance-none px-3 py-2 text-sm border border-blue-300 dark:border-blue-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 pr-10 cursor-pointer"
        >
          <option value="">Select approval...</option>
          <option value="all">All Approvals</option>
          <option value="approved">Approved</option>
          <option value="pending">Pending</option>
          <option value="denied">Denied</option>
        </select>
        <svg class="pointer-events-none absolute right-3 top-1/2 transform -translate-y-1/2 text-blue-600 dark:text-blue-400" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-lg p-3 mb-4">
    <p class="text-sm text-red-800 dark:text-red-200">{{ error }}</p>
  </div>

  <!-- Bulk Actions -->
  <div *ngIf="searchResults.length > 0" class="flex flex-wrap items-start justify-between gap-3 mb-4 p-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-gray-200 dark:border-gray-700">
    <div class="flex items-center gap-3 w-full sm:w-auto">
      <label class="flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300 cursor-pointer">
        <input
          type="checkbox"
          [checked]="selectedPrayers.size === searchResults.length && searchResults.length > 0"
          (change)="toggleSelectAll()"
          class="w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500"
        />
        <span>Select All ({{ searchResults.length }})</span>
      </label>
      <span *ngIf="selectedPrayers.size > 0" class="text-sm text-red-600 dark:text-red-400 font-medium">
        {{ selectedPrayers.size }} selected
      </span>
    </div>
    <div *ngIf="selectedPrayers.size > 0" class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3 w-full">
      <!-- Bulk Status Change -->
      <div class="flex items-center gap-2 w-full sm:w-auto">
        <label class="text-sm text-gray-700 dark:text-gray-300 whitespace-nowrap sm:mr-2">
          Change Status:
        </label>
        <div class="relative flex-1 sm:flex-none">
          <select
            [(ngModel)]="bulkStatus"
            class="w-full appearance-none px-3 py-1.5 text-sm border border-blue-300 dark:border-blue-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 pr-8 cursor-pointer"
          >
            <option value="">Select...</option>
            <option value="current">Current</option>
            <option value="answered">Answered</option>
            <option value="archived">Archived</option>
          </select>
          <svg class="pointer-events-none absolute right-2 top-1/2 transform -translate-y-1/2 text-blue-600 dark:text-blue-400" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </div>
      </div>

      <!-- Buttons row -->
      <div class="flex items-center gap-3 w-full sm:w-auto">
        <button
          (click)="updateSelectedStatus()"
          [disabled]="!bulkStatus || updatingStatus"
          class="flex-1 sm:flex-none flex items-center justify-center gap-1.5 px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed transition-colors text-sm"
        >
          <div *ngIf="updatingStatus" class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
          <svg *ngIf="!updatingStatus" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
            <polyline points="17 21 17 13 7 13 7 21"></polyline>
            <polyline points="7 3 7 8 15 8"></polyline>
          </svg>
          {{ updatingStatus ? 'Updating...' : 'Update (' + selectedPrayers.size + ')' }}
        </button>

        <button
          (click)="deleteSelected()"
          [disabled]="deleting"
          class="flex-1 sm:flex-none flex items-center justify-center gap-2 px-3 py-1.5 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-red-400 transition-colors text-sm"
        >
          <div *ngIf="deleting" class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
          <svg *ngIf="!deleting" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
          {{ deleting ? 'Deleting...' : 'Delete (' + selectedPrayers.size + ')' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Search Results -->
  <div *ngIf="searching" class="flex flex-col items-center justify-center py-12">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-red-600 dark:border-red-400 mb-4"></div>
    <p class="text-gray-600 dark:text-gray-400">Loading prayer data...</p>
  </div>

  <div *ngIf="!searching && searchResults.length > 0" class="space-y-1">
    <div *ngFor="let prayer of searchResults" 
         [class]="'border rounded-lg transition-all duration-200 ' + (selectedPrayers.has(prayer.id) ? 'bg-red-50 dark:bg-red-900/20 border-red-300 dark:border-red-700' : 'bg-gray-50 dark:bg-gray-900/50 border-gray-200 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-800')">
      
      <!-- Compact Header - Always Visible -->
      <div class="flex items-center gap-3 p-3">
        <input
          type="checkbox"
          [checked]="selectedPrayers.has(prayer.id)"
          (change)="toggleSelectPrayer(prayer.id)"
          (click)="$event.stopPropagation()"
          class="w-4 h-4 text-red-600 border-gray-800 dark:border-gray-600 rounded focus:ring-red-500 cursor-pointer"
        />
        
        <button
          (click)="toggleExpandCard(prayer.id)"
          class="flex-1 flex flex-col gap-1.5 text-left min-w-0"
        >
          <div class="flex items-center gap-2 flex-wrap">
            <h4 class="font-medium text-gray-900 dark:text-gray-100">
              {{ prayer.title }}
            </h4>
            <span [class]="'px-2 py-0.5 text-xs rounded-full capitalize flex-shrink-0 ' + getStatusColor(prayer.status)">
              {{ prayer.status }}
            </span>
            <span *ngIf="prayer.approval_status" [class]="'px-2 py-0.5 text-xs rounded-full capitalize flex-shrink-0 ' + getApprovalStatusColor(prayer.approval_status)">
              {{ prayer.approval_status }}
            </span>
            <span *ngIf="prayer.denial_reason" class="px-2 py-0.5 text-xs rounded-full bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 flex-shrink-0">
              Has Denial
            </span>
          </div>
          
          <div class="flex items-center gap-4 text-xs text-gray-600 dark:text-gray-400">
            <div>
              <span class="font-medium">Requester:</span> {{ prayer.requester }}
            </div>
            <div *ngIf="prayer.email" class="truncate">
              <span class="font-medium">Email:</span> {{ prayer.email }}
            </div>
            <div>
              <span class="font-medium">Created:</span> {{ prayer.created_at | date:'shortDate' }}
            </div>
          </div>
        </button>

        <div class="flex flex-col gap-2 flex-shrink-0">
          <svg *ngIf="expandedCards.has(prayer.id)" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400">
            <polyline points="18 15 12 9 6 15"></polyline>
          </svg>
          <svg *ngIf="!expandedCards.has(prayer.id)" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
          <button
            (click)="$event.stopPropagation(); startEditPrayer(prayer)"
            [disabled]="saving"
            class="p-1.5 text-blue-600 dark:text-blue-400 hover:bg-blue-100 dark:hover:bg-blue-900/30 rounded-lg transition-colors disabled:opacity-50"
            title="Edit this prayer"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
          </button>
          <button
            (click)="$event.stopPropagation(); deletePrayer(prayer)"
            [disabled]="deleting"
            class="p-1.5 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg transition-colors disabled:opacity-50"
            title="Delete this prayer"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Expanded Details - Only Visible When Expanded -->
      <div *ngIf="expandedCards.has(prayer.id)" class="px-6 pb-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800">
        <div class="pt-4 space-y-3">
          <div class="flex items-center justify-between mb-3">
            <h5 class="text-sm font-semibold text-gray-900 dark:text-gray-100">
              {{ editingPrayer === prayer.id ? 'Edit Prayer Details' : 'Complete Prayer Details' }}
            </h5>
            <div *ngIf="editingPrayer === prayer.id" class="flex gap-2">
              <button
                (click)="savePrayer(prayer.id)"
                [disabled]="saving"
                class="flex items-center gap-1 px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm disabled:opacity-50"
              >
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                  <polyline points="17 21 17 13 7 13 7 21"></polyline>
                  <polyline points="7 3 7 8 15 8"></polyline>
                </svg>
                {{ saving ? 'Saving...' : 'Save' }}
              </button>
              <button
                (click)="cancelEdit()"
                [disabled]="saving"
                class="flex items-center gap-1 px-3 py-1 bg-gray-500 hover:bg-gray-600 text-white rounded-lg text-sm disabled:opacity-50"
              >
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="15" y1="9" x2="9" y2="15"></line>
                  <line x1="9" y1="9" x2="15" y2="15"></line>
                </svg>
                Cancel
              </button>
            </div>
          </div>
          
          <!-- Edit Mode Form -->
          <div *ngIf="editingPrayer === prayer.id" class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                Title *
              </label>
              <input
                type="text"
                [(ngModel)]="editForm.title"
                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500"
                placeholder="Prayer title"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                Description *
              </label>
              <textarea
                [(ngModel)]="editForm.description"
                rows="4"
                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500"
                placeholder="Prayer description"
              ></textarea>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                  Requester *
                </label>
                <input
                  type="text"
                  [(ngModel)]="editForm.requester"
                  class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500"
                  placeholder="Requester name"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                  Email
                </label>
                <input
                  type="email"
                  [(ngModel)]="editForm.email"
                  class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500"
                  placeholder="Email address"
                />
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                Praying For
              </label>
              <input
                type="text"
                [(ngModel)]="editForm.prayer_for"
                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500"
                placeholder="Person being prayed for"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                Status *
              </label>
              <div class="relative">
                <select
                  [(ngModel)]="editForm.status"
                  class="w-full appearance-none px-3 py-2 text-sm border border-blue-300 dark:border-blue-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 pr-10 cursor-pointer"
                >
                  <option value="current">Current</option>
                  <option value="answered">Answered</option>
                  <option value="archived">Archived</option>
                </select>
                <svg class="pointer-events-none absolute right-3 top-1/2 transform -translate-y-1/2 text-blue-600 dark:text-blue-400" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
            </div>
          </div>

          <!-- View Mode -->
          <ng-container *ngIf="editingPrayer !== prayer.id">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <!-- Basic Information -->
              <div class="space-y-3">
                <div class="bg-gray-50 dark:bg-gray-900/50 p-3 rounded-lg border border-gray-200 dark:border-gray-700">
                  <h6 class="text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase mb-2">
                    Basic Information
                  </h6>
                  
                  <div class="space-y-2 text-sm">
                    <div>
                      <span class="font-medium text-gray-700 dark:text-gray-300">Title:</span>
                      <span class="ml-2 text-gray-600 dark:text-gray-400">{{ prayer.title }}</span>
                    </div>
                    
                    <div>
                      <span class="font-medium text-gray-700 dark:text-gray-300">Requester:</span>
                      <span class="ml-2 text-gray-600 dark:text-gray-400">{{ prayer.requester }}</span>
                    </div>
                    
                    <div *ngIf="prayer.email">
                      <span class="font-medium text-gray-700 dark:text-gray-300">Email:</span>
                      <span class="ml-2 text-gray-600 dark:text-gray-400">{{ prayer.email }}</span>
                    </div>
                    
                    <div *ngIf="prayer.prayer_for">
                      <span class="font-medium text-gray-700 dark:text-gray-300">Praying For:</span>
                      <span class="ml-2 text-gray-600 dark:text-gray-400">{{ prayer.prayer_for }}</span>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Status Information -->
              <div class="space-y-3">
                <div class="bg-gray-50 dark:bg-gray-900/50 p-3 rounded-lg border border-gray-200 dark:border-gray-700">
                  <h6 class="text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase mb-2">
                    Status Information
                  </h6>
                  
                  <div class="space-y-2 text-sm">
                    <div>
                      <span class="font-medium text-gray-700 dark:text-gray-300">Prayer Status:</span>
                      <span [class]="'ml-2 px-2 py-0.5 text-xs rounded-full capitalize ' + getStatusColor(prayer.status)">
                        {{ prayer.status }}
                      </span>
                    </div>
                    
                    <div *ngIf="prayer.approval_status">
                      <span class="font-medium text-gray-700 dark:text-gray-300">Approval Status:</span>
                      <span [class]="'ml-2 px-2 py-0.5 text-xs rounded-full capitalize ' + getApprovalStatusColor(prayer.approval_status)">
                        {{ prayer.approval_status }}
                      </span>
                    </div>
                    
                    <div>
                      <span class="font-medium text-gray-700 dark:text-gray-300">Created:</span>
                      <div class="ml-2 text-gray-600 dark:text-gray-400">
                        <div>{{ prayer.created_at | date:'fullDate' }}</div>
                        <div class="text-xs">{{ prayer.created_at | date:'mediumTime' }}</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Description -->
            <div *ngIf="prayer.description" class="bg-gray-50 dark:bg-gray-900/50 p-3 rounded-lg border border-gray-200 dark:border-gray-700">
              <h6 class="text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase mb-2">
                Prayer Description
              </h6>
              <p class="text-sm text-gray-600 dark:text-gray-400 whitespace-pre-wrap leading-relaxed">
                {{ prayer.description }}
              </p>
            </div>
            
            <!-- Denial Reason - Highlighted if present -->
            <div *ngIf="prayer.denial_reason" class="bg-red-50 dark:bg-red-900/20 p-3 rounded-lg border border-red-200 dark:border-red-800">
              <h6 class="text-xs font-semibold text-red-700 dark:text-red-300 uppercase mb-2 flex items-center gap-2">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                  <line x1="12" y1="9" x2="12" y2="13"></line>
                  <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
                Denial Reason
              </h6>
              <p class="text-sm text-red-600 dark:text-red-400 whitespace-pre-wrap leading-relaxed">
                {{ prayer.denial_reason }}
              </p>
            </div>
            
            <!-- Prayer Updates Section -->
            <div *ngIf="prayer.prayer_updates && prayer.prayer_updates.length > 0" class="bg-gray-50 dark:bg-gray-900/50 p-3 rounded-lg border border-gray-200 dark:border-gray-700">
              <h6 class="text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase mb-3">
                Prayer Updates ({{ prayer.prayer_updates.length }})
              </h6>
              <div class="space-y-3">
                <div *ngFor="let update of prayer.prayer_updates; let i = index" 
                     [class]="'p-3 rounded border ' + (update.denial_reason ? 'bg-red-50 dark:bg-red-900/20 border-red-300 dark:border-red-700' : 'bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700')">
                  <div class="flex justify-between items-start mb-2">
                    <div class="flex items-center gap-2">
                      <span class="text-xs font-medium text-gray-700 dark:text-gray-300">
                        Update #{{ prayer.prayer_updates!.length - i }}
                      </span>
                      <span *ngIf="update.approval_status" [class]="'px-2 py-0.5 text-xs rounded-full capitalize ' + getApprovalStatusColor(update.approval_status)">
                        {{ update.approval_status }}
                      </span>
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="text-xs text-gray-500 dark:text-gray-500">
                        {{ update.created_at | date:'shortDate' }}
                      </span>
                      <button
                        (click)="deleteUpdate(prayer.id, update.id, update.content)"
                        [disabled]="deleting"
                        class="p-1 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/30 rounded transition-colors disabled:opacity-50"
                        title="Delete this update"
                      >
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <polyline points="3 6 5 6 21 6"></polyline>
                          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                      </button>
                    </div>
                  </div>
                  <p class="text-sm text-gray-600 dark:text-gray-400 whitespace-pre-wrap mb-2">
                    {{ update.content }}
                  </p>
                  <div *ngIf="update.denial_reason" class="mt-2 p-2 bg-red-100 dark:bg-red-900/30 rounded border-l-2 border-red-500">
                    <div class="flex items-start gap-2">
                      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-600 dark:text-red-400 mt-0.5 flex-shrink-0">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                        <line x1="12" y1="9" x2="12" y2="13"></line>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                      </svg>
                      <div>
                        <p class="text-xs font-semibold text-red-700 dark:text-red-300 mb-1">
                          Denial Reason:
                        </p>
                        <p class="text-xs text-red-600 dark:text-red-400">
                          {{ update.denial_reason }}
                        </p>
                      </div>
                    </div>
                  </div>
                  <div class="text-xs text-gray-500 dark:text-gray-500 mt-2">
                    <span class="font-medium">By:</span> {{ update.author }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Add Update Section -->
            <div *ngIf="!editingPrayer" class="bg-gray-50 dark:bg-gray-900/50 p-3 rounded-lg border border-gray-200 dark:border-gray-700">
              <div *ngIf="addingUpdate === prayer.id" class="space-y-3">
                <div class="flex items-center justify-between mb-2">
                  <h6 class="text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase">
                    Add New Update
                  </h6>
                  <div class="flex gap-2">
                    <button
                      (click)="saveNewUpdate(prayer.id)"
                      [disabled]="savingUpdate"
                      class="flex items-center gap-1 px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm disabled:opacity-50"
                    >
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                        <polyline points="17 21 17 13 7 13 7 21"></polyline>
                        <polyline points="7 3 7 8 15 8"></polyline>
                      </svg>
                      {{ savingUpdate ? 'Saving...' : 'Save Update' }}
                    </button>
                    <button
                      (click)="cancelAddUpdate()"
                      [disabled]="savingUpdate"
                      class="flex items-center gap-1 px-3 py-1 bg-gray-500 hover:bg-gray-600 text-white rounded-lg text-sm disabled:opacity-50"
                    >
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="15" y1="9" x2="9" y2="15"></line>
                        <line x1="9" y1="9" x2="15" y2="15"></line>
                      </svg>
                      Cancel
                    </button>
                  </div>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    Update Content *
                  </label>
                  <textarea
                    [(ngModel)]="newUpdate.content"
                    rows="4"
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500"
                    placeholder="Enter the update content..."
                  ></textarea>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    Author Name *
                  </label>
                  <input
                    type="text"
                    [(ngModel)]="newUpdate.author"
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500"
                    placeholder="Your name"
                  />
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    Author Email *
                  </label>
                  <input
                    type="email"
                    [(ngModel)]="newUpdate.author_email"
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500"
                    placeholder="your.email@example.com"
                  />
                </div>
              </div>

              <button
                *ngIf="addingUpdate !== prayer.id"
                (click)="addingUpdate = prayer.id"
                class="w-full flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors"
              >
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Add Update
              </button>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty States -->
  <div *ngIf="!searching && searchResults.length === 0 && searchTerm && !statusFilter && !approvalFilter" class="text-center py-8 text-gray-500 dark:text-gray-400">
    <svg class="mx-auto mb-2 opacity-50" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
      <line x1="12" y1="9" x2="12" y2="13"></line>
      <line x1="12" y1="17" x2="12.01" y2="17"></line>
    </svg>
    <p>No prayers found</p>
    <p class="text-sm mt-1">Try a different search term</p>
  </div>

  <div *ngIf="!searching && searchResults.length === 0 && !searchTerm && !statusFilter && !approvalFilter" class="text-center py-8 text-gray-500 dark:text-gray-400">
    <svg class="mx-auto mb-2 opacity-50" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="11" cy="11" r="8"></circle>
      <path d="m21 21-4.35-4.35"></path>
    </svg>
    <p>Search Prayers & Audit Log</p>
    <div class="text-sm mt-2 space-y-1">
      <p>• Select a filter from the dropdowns to automatically load results</p>
      <p>• Or search by title, requester, email, description, or denial reasons</p>
      <p>• Select "Denied" to see all denied prayers and activities</p>
    </div>
  </div>

  <!-- Results Summary -->
  <div *ngIf="searchResults.length > 0" class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
    <div class="flex items-center justify-between text-sm">
      <span class="text-gray-600 dark:text-gray-400">
        Found: <span class="font-semibold">{{ searchResults.length }}</span> prayer(s)
      </span>
      <span *ngIf="selectedPrayers.size > 0" class="text-red-600 dark:text-red-400">
        Selected: <span class="font-semibold">{{ selectedPrayers.size }}</span>
      </span>
    </div>
  </div>

  <!-- Warning Notice -->
  <div class="mt-4 flex items-start gap-2 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-700 rounded-lg">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5">
      <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
      <line x1="12" y1="9" x2="12" y2="13"></line>
      <line x1="12" y1="17" x2="12.01" y2="17"></line>
    </svg>
    <p class="text-sm text-amber-800 dark:text-amber-200">
      <strong>Warning:</strong> Deleting prayers is permanent and cannot be undone. All associated updates will also be deleted.
    </p>
  </div>
</div>
